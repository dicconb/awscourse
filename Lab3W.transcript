**********************
Windows PowerShell transcript start
Start time: 20150707122637
Username: WIN-FFRLCUINKFO\Administrator
RunAs User: WIN-FFRLCUINKFO\Administrator
Machine: WIN-FFRLCUINKFO (Microsoft Windows NT 6.2.9200.0)
Host Application: C:\Windows\System32\WindowsPowerShell\v1.0\powershell_ise.exe
Process ID: 1492
**********************
Transcript started, output file is C:\Users\Administrator\Documents\giterpos\awscourse\Lab3W.transcript

PS C:\Windows\system32> aws ec2 describe-instances --filter 'Name=tag:Name,Values=Processor'
{
    "Reservations": [
        {
            "OwnerId": "757392372568",
            "ReservationId": "r-cc430c28",
            "Groups": [],
            "Instances": [
                {
                    "Monitoring": {
                        "State": "disabled"
                    },
                    "PublicDnsName": "ec2-52-18-93-252.eu-west-1.compute.amazonaws.com",
                    "Platform": "windows",
                    "State": {
                        "Code": 16,
                        "Name": "running"
                    },
                    "EbsOptimized": false,
                    "LaunchTime": "2015-07-07T12:13:19.000Z",
                    "PublicIpAddress": "52.18.93.252",
                    "PrivateIpAddress": "10.5.0.253",
                    "ProductCodes": [],
                    "VpcId": "vpc-ec9b1889",
                    "StateTransitionReason": "",
                    "InstanceId": "i-ea821a40",
                    "ImageId": "ami-c1740ab6",
                    "PrivateDnsName": "ip-10-5-0-253.eu-west-1.compute.internal",
                    "KeyName": "qwikLABS-L474-10607",
                    "SecurityGroups": [
                        {
                            "GroupName": "RDP Access",
                            "GroupId": "sg-e5fffd80"
                        }
                    ],
                    "ClientToken": "ocwRH1436271199396",
                    "SubnetId": "subnet-fba9d59e",
                    "InstanceType": "t2.medium",
                    "NetworkInterfaces": [
                        {
                            "Status": "in-use",
                            "MacAddress": "02:73:b6:a3:d6:09",
                            "SourceDestCheck": true,
                            "VpcId": "vpc-ec9b1889",
                            "Description": "Primary network interface",
                            "Association": {
                                "PublicIp": "52.18.93.252",
                                "PublicDnsName": "ec2-52-18-93-252.eu-west-1.compute.amazonaws.com",
                                "IpOwnerId": "amazon"
                            },
                            "NetworkInterfaceId": "eni-b237d6d5",
                            "PrivateIpAddresses": [
                                {
                                    "PrivateDnsName": "ip-10-5-0-253.eu-west-1.compute.internal",
                                    "Association": {
                                        "PublicIp": "52.18.93.252",
                                        "PublicDnsName": "ec2-52-18-93-252.eu-west-1.compute.amazonaws.com",
                                        "IpOwnerId": "amazon"
                                    },
                                    "Primary": true,
                                    "PrivateIpAddress": "10.5.0.253"
                                }
                            ],
                            "PrivateDnsName": "ip-10-5-0-253.eu-west-1.compute.internal",
                            "Attachment": {
                                "Status": "attached",
                                "DeviceIndex": 0,
                                "DeleteOnTermination": true,
                                "AttachmentId": "eni-attach-0e16354d",
                                "AttachTime": "2015-07-07T12:13:19.000Z"
                            },
                            "Groups": [
                                {
                                    "GroupName": "RDP Access",
                                    "GroupId": "sg-e5fffd80"
                                }
                            ],
                            "SubnetId": "subnet-fba9d59e",
                            "OwnerId": "757392372568",
                            "PrivateIpAddress": "10.5.0.253"
                        }
                    ],
                    "SourceDestCheck": true,
                    "Placement": {
                        "Tenancy": "default",
                        "GroupName": "",
                        "AvailabilityZone": "eu-west-1a"
                    },
                    "Hypervisor": "xen",
                    "BlockDeviceMappings": [
                        {
                            "DeviceName": "/dev/sda1",
                            "Ebs": {
                                "Status": "attached",
                                "DeleteOnTermination": true,
                                "VolumeId": "vol-cbc9d9dc",
                                "AttachTime": "2015-07-07T12:13:23.000Z"
                            }
                        }
                    ],
                    "Architecture": "x86_64",
                    "RootDeviceType": "ebs",
                    "IamInstanceProfile": {
                        "Id": "AIPAJ7HTI4DABFET35OMG",
                        "Arn": "arn:aws:iam::757392372568:instance-profile/S3BucketAccess"
                    },
                    "RootDeviceName": "/dev/sda1",
                    "VirtualizationType": "hvm",
                    "Tags": [
                        {
                            "Value": "Processor",
                            "Key": "Name"
                        }
                    ],
                    "AmiLaunchIndex": 0
                }
            ]
        }
    ]
}

PS C:\Windows\system32> aws ec2 describe-instances --filter 'Name=tag:Name,Values=Processor' --query 'Reservations[0].Instances[0].BlockDeviceMappings[0].Ebs.{VolumeId:VolumeId}'
{
    "VolumeId": "vol-cbc9d9dc"
}

PS C:\Windows\system32> aws ec2 describe-instances --filters 'Name=tag:Name,Values=Processor' --query 'Reservations[0].Instances[0].InstanceId'
"i-ea821a40"

PS C:\Windows\system32> aws ec2 stop-instances --instance-ids "i-ea821a40"
{
    "StoppingInstances": [
        {
            "InstanceId": "i-ea821a40",
            "CurrentState": {
                "Code": 64,
                "Name": "stopping"
            },
            "PreviousState": {
                "Code": 16,
                "Name": "running"
            }
        }
    ]
}

PS C:\Windows\system32> aws ec2 describe-instance-status --instance-id "i-ea821a40"
{
    "InstanceStatuses": []
}

PS C:\Windows\system32> aws ec2 describe-instance-status --instance-id "i-ea821a40"
{
    "InstanceStatuses": []
}

PS C:\Windows\system32> aws ec2 create-snapshot --volume-id "vol-cbc9d9dc"
{
    "Description": "",
    "Encrypted": false,
    "VolumeId": "vol-cbc9d9dc",
    "State": "pending",
    "VolumeSize": 35,
    "Progress": "",
    "StartTime": "2015-07-07T12:29:07.000Z",
    "SnapshotId": "snap-6e5a3638",
    "OwnerId": "757392372568"
}

PS C:\Windows\system32> aws ec2 describe-snapshots --snapshot-id "snap-6e5a3638"
{
    "Snapshots": [
        {
            "Description": "",
            "Encrypted": false,
            "VolumeId": "vol-cbc9d9dc",
            "State": "completed",
            "VolumeSize": 35,
            "Progress": "100%",
            "StartTime": "2015-07-07T12:29:07.000Z",
            "SnapshotId": "snap-6e5a3638",
            "OwnerId": "757392372568"
        }
    ]
}

PS C:\Windows\system32> aws ec2 start-instances --instance-ids "i-ea821a40"
{
    "StartingInstances": [
        {
            "InstanceId": "i-ea821a40",
            "CurrentState": {
                "Code": 0,
                "Name": "pending"
            },
            "PreviousState": {
                "Code": 80,
                "Name": "stopped"
            }
        }
    ]
}

PS C:\Windows\system32> aws ec2 describe-instance-status --instance-id "i-ea821a40"
{
    "InstanceStatuses": [
        {
            "InstanceId": "i-ea821a40",
            "InstanceState": {
                "Code": 16,
                "Name": "running"
            },
            "AvailabilityZone": "eu-west-1a",
            "SystemStatus": {
                "Status": "initializing",
                "Details": [
                    {
                        "Status": "initializing",
                        "Name": "reachability"
                    }
                ]
            },
            "InstanceStatus": {
                "Status": "initializing",
                "Details": [
                    {
                        "Status": "initializing",
                        "Name": "reachability"
                    }
                ]
            }
        }
    ]
}

PS C:\Windows\system32> type C:\Users\Administrator\.aws\config
[default]
region = eu-west-1

PS C:\Windows\system32> aws ec2 create-snapshot --volume-id "vol-cbc9d9dc" --region "eu-west-1" >c:\temp\output.txt 2>&1
>> ParameterBinding(Out-File): name="InputObject"; value="{"
>> ParameterBinding(Out-File): name="InputObject"; value="    "Description": "", "
>> ParameterBinding(Out-File): name="InputObject"; value="    "Encrypted": false, "
>> ParameterBinding(Out-File): name="InputObject"; value="    "VolumeId": "vol-cbc9d9dc", "
>> ParameterBinding(Out-File): name="InputObject"; value="    "State": "pending", "
>> ParameterBinding(Out-File): name="InputObject"; value="    "VolumeSize": 35, "
>> ParameterBinding(Out-File): name="InputObject"; value="    "Progress": "", "
>> ParameterBinding(Out-File): name="InputObject"; value="    "StartTime": "2015-07-07T12:33:53.000Z", "
>> ParameterBinding(Out-File): name="InputObject"; value="    "SnapshotId": "snap-2b12337f", "
>> ParameterBinding(Out-File): name="InputObject"; value="    "OwnerId": "757392372568""
>> ParameterBinding(Out-File): name="InputObject"; value="}"

PS C:\Windows\system32> net user backupuser passw0rd! /ADD
The command completed successfully.


PS C:\Windows\system32> c:\temp\ntrights +R SeBatchLogonRight -u backupuser
 Granting SeBatchLogonRight to backupuser   ... successful

              CurrentMatchIndex               ReplacementIndex              ReplacementLength CompletionMatches
              -----------------               ----------------              ----------------- -----------------
                             -1                              0                              4 {System.Management.Automati...



PS C:\Windows\system32> get-content c:\temp\backup.bat
get-content : Cannot find path 'C:\temp\backup.bat' because it does not exist.
At line:1 char:1
+ get-content c:\temp\backup.bat
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\temp\backup.bat:String) [Get-Content], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand


              CurrentMatchIndex               ReplacementIndex              ReplacementLength CompletionMatches
              -----------------               ----------------              ----------------- -----------------
                             -1                           2152                              4 {System.Management.Automati...



              CurrentMatchIndex               ReplacementIndex              ReplacementLength CompletionMatches
              -----------------               ----------------              ----------------- -----------------
                             -1                           2161                              3 {System.Management.Automati...



              CurrentMatchIndex               ReplacementIndex              ReplacementLength CompletionMatches
              -----------------               ----------------              ----------------- -----------------
                             -1                           2161                              8 {System.Management.Automati...



              CurrentMatchIndex               ReplacementIndex              ReplacementLength CompletionMatches
              -----------------               ----------------              ----------------- -----------------
                             -1                           2161                             15 {}



PS C:\Windows\system32> 'aws ec2 create-snapshot --volume-id "vol-cbc9d9dc" --region "eu-west-1" >c:\temp\output.txt 2>&1' | out-file C:\temp\backup.bat

PS C:\Windows\system32> schtasks /create /sc MINUTE /mo 1 /tn "Volume Backup Task" /ru backupuser /rp passw0rd! /tr c:\temp\backup.bat
SUCCESS: The scheduled task "Volume Backup Task" has successfully been created.

PS C:\Windows\system32> aws ec2 describe-snapshots --filters "Name=volume-id,Values=vol-cbc9d9dc"
{
    "Snapshots": [
        {
            "Description": "",
            "Encrypted": false,
            "VolumeId": "vol-cbc9d9dc",
            "State": "completed",
            "VolumeSize": 35,
            "Progress": "100%",
            "StartTime": "2015-07-07T12:33:53.000Z",
            "SnapshotId": "snap-2b12337f",
            "OwnerId": "757392372568"
        },
        {
            "Description": "",
            "Encrypted": false,
            "VolumeId": "vol-cbc9d9dc",
            "State": "completed",
            "VolumeSize": 35,
            "Progress": "100%",
            "StartTime": "2015-07-07T12:29:07.000Z",
            "SnapshotId": "snap-6e5a3638",
            "OwnerId": "757392372568"
        }
    ]
}

              CurrentMatchIndex               ReplacementIndex              ReplacementLength CompletionMatches
              -----------------               ----------------              ----------------- -----------------
                             -1                           2623                              7 {System.Management.Automati...



              CurrentMatchIndex               ReplacementIndex              ReplacementLength CompletionMatches
              -----------------               ----------------              ----------------- -----------------
                             -1                           2634                              7 {}



PS C:\Windows\system32> get-date | out-default;aws ec2 describe-snapshots --filters "Name=volume-id,Values=vol-cbc9d9dc"

Tuesday, July 7, 2015 12:39:52 PM


{
    "Snapshots": [
        {
            "Description": "",
            "Encrypted": false,
            "VolumeId": "vol-cbc9d9dc",
            "State": "completed",
            "VolumeSize": 35,
            "Progress": "100%",
            "StartTime": "2015-07-07T12:33:53.000Z",
            "SnapshotId": "snap-2b12337f",
            "OwnerId": "757392372568"
        },
        {
            "Description": "",
            "Encrypted": false,
            "VolumeId": "vol-cbc9d9dc",
            "State": "completed",
            "VolumeSize": 35,
            "Progress": "100%",
            "StartTime": "2015-07-07T12:29:07.000Z",
            "SnapshotId": "snap-6e5a3638",
            "OwnerId": "757392372568"
        }
    ]
}
